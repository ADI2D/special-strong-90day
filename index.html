<!DOCTYPE html>
<html lang="en">
<head>
  <me
ta charset="UTF-8">
  <meta name="viewport" c
ontent="width=device-width, initial-scale=1.0
">
  <title>DAMB Plan</title>
  <style>
    :
root {
      --bg: #0f172a;
      --surface: 
#1e293b;
      --surface-hover: #334155;
    
  --border: #475569;
      --text: #f1f5f9;
 
     --text-muted: #94a3b8;
      --accent: #
3b82f6;
      --success: #22c55e;
      --war
ning: #f59e0b;
      --danger: #ef4444;
     
 --purple: #6366f1;
    }
    
    * { box-si
zing: border-box; margin: 0; padding: 0; }
  
  
    body {
      font-family: -apple-syste
m, BlinkMacSystemFont, 'Segoe UI', Roboto, sa
ns-serif;
      background: var(--bg);
      
color: var(--text);
      line-height: 1.5;
 
     min-height: 100vh;
    }
    
    .conta
iner {
      max-width: 1400px;
      margin:
 0 auto;
      padding: 24px;
    }
    
    
header {
      display: flex;
      justify-c
ontent: space-between;
      align-items: fle
x-start;
      margin-bottom: 32px;
      fle
x-wrap: wrap;
      gap: 16px;
    }
    
   
 h1 {
      font-size: 28px;
      font-weigh
t: 700;
    }
    
    .subtitle {
      colo
r: var(--text-muted);
      font-size: 14px;

      margin-top: 4px;
    }
    
    .stats 
{
      display: flex;
      gap: 24px;
     
 flex-wrap: wrap;
    }
    
    .stat {
    
  text-align: center;
    }
    
    .stat-va
lue {
      font-size: 32px;
      font-weigh
t: 700;
    }
    
    .stat-label {
      fo
nt-size: 12px;
      color: var(--text-muted)
;
      text-transform: uppercase;
      lett
er-spacing: 0.5px;
    }
    
    .filters {

      display: flex;
      gap: 12px;
      m
argin-bottom: 24px;
      flex-wrap: wrap;
  
  }
    
    .filter-btn {
      padding: 8px
 16px;
      border: 1px solid var(--border);

      border-radius: 8px;
      background: 
var(--surface);
      color: var(--text);
   
   cursor: pointer;
      font-size: 14px;
  
    transition: all 0.2s;
    }
    
    .fil
ter-btn:hover {
      background: var(--surfa
ce-hover);
    }
    
    .filter-btn.active 
{
      background: var(--accent);
      bord
er-color: var(--accent);
    }
    
    .main
-grid {
      display: grid;
      grid-templ
ate-columns: 1fr 380px;
      gap: 24px;
    
}
    
    @media (max-width: 1024px) {
     
 .main-grid {
        grid-template-columns: 
1fr;
      }
    }
    
    .panel {
      ba
ckground: var(--surface);
      border-radius
: 12px;
      padding: 20px;
      border: 1p
x solid var(--border);
    }
    
    .panel-
title {
      font-size: 16px;
      font-wei
ght: 600;
      margin-bottom: 16px;
      di
splay: flex;
      align-items: center;
     
 gap: 8px;
    }
    
    /* Timeline */
    
.timeline-container {
      overflow-x: auto;

      margin-bottom: 24px;
    }
    
    .t
imeline {
      min-width: 800px;
      posit
ion: relative;
    }
    
    .timeline-heade
r {
      display: flex;
      border-bottom:
 1px solid var(--border);
      padding-botto
m: 8px;
      margin-bottom: 16px;
    }
    

    .timeline-phase {
      flex: 1;
      t
ext-align: center;
      padding: 8px;
      
font-size: 13px;
      font-weight: 600;
    
  border-radius: 6px;
      margin: 0 4px;
  
  }
    
    .timeline-track {
      position
: relative;
      height: 8px;
      backgrou
nd: var(--surface-hover);
      border-radius
: 4px;
      margin-bottom: 24px;
    }
    

    .timeline-progress {
      position: abso
lute;
      height: 100%;
      background: l
inear-gradient(90deg, var(--purple), var(--su
ccess));
      border-radius: 4px;
      tran
sition: width 0.3s;
    }
    
    .timeline-
today {
      position: absolute;
      top: 
-4px;
      width: 3px;
      height: 16px;
 
     background: var(--danger);
      border-
radius: 2px;
      z-index: 10;
    }
    
  
  .timeline-today::after {
      content: 'TO
DAY';
      position: absolute;
      top: -2
0px;
      left: 50%;
      transform: transl
ateX(-50%);
      font-size: 10px;
      colo
r: var(--danger);
      font-weight: 600;
   
 }
    
    /* Task List */
    .task-list {

      display: flex;
      flex-direction: co
lumn;
      gap: 12px;
    }
    
    .task-c
ard {
      background: var(--bg);
      bord
er: 1px solid var(--border);
      border-rad
ius: 8px;
      padding: 16px;
      cursor: 
pointer;
      transition: all 0.2s;
      bo
rder-left: 4px solid var(--border);
    }
   
 
    .task-card:hover {
      border-color: 
var(--accent);
      transform: translateX(4p
x);
    }
    
    .task-card.complete {
    
  opacity: 0.6;
      border-left-color: var(
--success);
    }
    
    .task-card.in-prog
ress {
      border-left-color: var(--warning
);
    }
    
    .task-card.overdue {
      
border-left-color: var(--danger);
    }
    

    .task-header {
      display: flex;
     
 justify-content: space-between;
      align-
items: flex-start;
      gap: 12px;
      mar
gin-bottom: 8px;
    }
    
    .task-title {

      font-weight: 600;
      font-size: 14p
x;
    }
    
    .task-type {
      font-siz
e: 11px;
      padding: 2px 8px;
      border
-radius: 4px;
      text-transform: uppercase
;
      font-weight: 600;
      white-space: 
nowrap;
    }
    
    .task-type.milestone {
 background: var(--purple); }
    .task-type.
deliverable { background: var(--success); }
 
   .task-type.task { background: var(--accent
); }
    .task-type.decision { background: va
r(--warning); color: #000; }
    
    /* Cate
gory badges */
    .task-category {
      fon
t-size: 11px;
      padding: 2px 8px;
      b
order-radius: 4px;
      font-weight: 600;
  
    white-space: nowrap;
      display: inlin
e-flex;
      align-items: center;
      gap:
 4px;
    }
    
    .task-subcategory {
    
  font-size: 10px;
      padding: 2px 6px;
  
    border-radius: 3px;
      font-weight: 50
0;
      white-space: nowrap;
      backgroun
d: rgba(255,255,255,0.1);
      color: var(--
text-muted);
    }
    
    .category-row {
 
     display: flex;
      align-items: center
;
      gap: 8px;
      margin-bottom: 8px;
 
   }
    
    /* Category filter pills */
   
 .category-filters {
      display: flex;
   
   gap: 8px;
      margin-bottom: 16px;
     
 flex-wrap: wrap;
      padding-bottom: 16px;

      border-bottom: 1px solid var(--border)
;
    }
    
    .category-filter-btn {
     
 padding: 6px 14px;
      border: 2px solid t
ransparent;
      border-radius: 20px;
      
cursor: pointer;
      font-size: 13px;
     
 font-weight: 600;
      transition: all 0.2s
;
      display: inline-flex;
      align-ite
ms: center;
      gap: 6px;
    }
    
    .c
ategory-filter-btn:hover {
      filter: brig
htness(1.1);
    }
    
    .category-filter-
btn.active {
      box-shadow: 0 0 0 2px var(
--text);
    }
    
    .task-meta {
      di
splay: flex;
      gap: 16px;
      font-size
: 12px;
      color: var(--text-muted);
    }

    
    .task-notes {
      font-size: 12px
;
      color: var(--text-muted);
      margi
n-top: 8px;
      padding-top: 8px;
      bor
der-top: 1px solid var(--border);
    }
    

    /* Focus Panel */
    .focus-section {
  
    margin-bottom: 20px;
    }
    
    .focu
s-label {
      font-size: 11px;
      text-t
ransform: uppercase;
      color: var(--text-
muted);
      letter-spacing: 0.5px;
      ma
rgin-bottom: 8px;
    }
    
    .focus-item 
{
      background: var(--bg);
      border-r
adius: 6px;
      padding: 12px;
      margin
-bottom: 8px;
      font-size: 13px;
    }
  
  
    .focus-item.urgent {
      border-left
: 3px solid var(--danger);
    }
    
    .fo
cus-item.soon {
      border-left: 3px solid 
var(--warning);
    }
    
    .countdown {
 
     font-size: 11px;
      color: var(--text
-muted);
      margin-top: 4px;
    }
    
  
  /* Dependencies */
    .dep-graph {
      m
argin-top: 16px;
    }
    
    .dep-item {
 
     display: flex;
      align-items: center
;
      gap: 8px;
      font-size: 12px;
    
  padding: 8px 0;
      border-bottom: 1px so
lid var(--border);
    }
    
    .dep-arrow 
{
      color: var(--text-muted);
    }
    

    /* Status badges */
    .status {
      d
isplay: inline-flex;
      align-items: cente
r;
      gap: 4px;
      font-size: 11px;
   
   padding: 2px 8px;
      border-radius: 4px
;
    }
    
    .status.complete { backgroun
d: rgba(34, 197, 94, 0.2); color: var(--succe
ss); }
    .status.in-progress { background: 
rgba(245, 158, 11, 0.2); color: var(--warning
); }
    .status.pending { background: rgba(1
48, 163, 184, 0.2); color: var(--text-muted);
 }
    
    .status-dot {
      width: 6px;
 
     height: 6px;
      border-radius: 50%;
 
     background: currentColor;
    }
    
   
 /* Phase sections */
    .phase-group {
    
  margin-bottom: 32px;
    }
    
    .phase-
header {
      display: flex;
      align-ite
ms: center;
      gap: 12px;
      margin-bot
tom: 16px;
      padding-bottom: 8px;
      b
order-bottom: 2px solid var(--border);
    }

    
    .phase-indicator {
      width: 12px
;
      height: 12px;
      border-radius: 3p
x;
    }
    
    .phase-name {
      font-we
ight: 600;
      font-size: 16px;
    }
    

    .phase-dates {
      font-size: 12px;
   
   color: var(--text-muted);
    }
    
    /
* Progress ring */
    .progress-ring {
     
 width: 80px;
      height: 80px;
    }
    

    .progress-ring-circle {
      transition:
 stroke-dashoffset 0.3s;
      transform: rot
ate(-90deg);
      transform-origin: 50% 50%;

    }
    
    /* Empty state */
    .empty-
state {
      text-align: center;
      paddi
ng: 40px;
      color: var(--text-muted);
   
 }
    
    /* Modal */
    .modal-overlay {

      position: fixed;
      inset: 0;
      
background: rgba(0,0,0,0.7);
      display: n
one;
      align-items: center;
      justify
-content: center;
      z-index: 100;
    }
 
   
    .modal-overlay.open {
      display: 
flex;
    }
    
    .modal {
      backgroun
d: var(--surface);
      border-radius: 12px;

      padding: 24px;
      max-width: 500px;

      width: 90%;
      max-height: 80vh;
  
    overflow-y: auto;
    }
    
    .modal h
2 {
      margin-bottom: 16px;
    }
    
   
 .modal-close {
      float: right;
      bac
kground: none;
      border: none;
      colo
r: var(--text-muted);
      font-size: 24px;

      cursor: pointer;
    }
    
    .btn {

      padding: 10px 20px;
      border-radius
: 8px;
      font-weight: 600;
      cursor: 
pointer;
      border: none;
      transition
: all 0.2s;
    }
    
    .btn-primary {
   
   background: var(--accent);
      color: wh
ite;
    }
    
    .btn-primary:hover {
    
  filter: brightness(1.1);
    }
    
    .bt
n-success {
      background: var(--success);

      color: white;
    }
    
    .modal-ac
tions {
      display: flex;
      gap: 12px;

      margin-top: 20px;
    }
    
    /* Ed
itable fields */
    .edit-field {
      widt
h: 100%;
      background: var(--bg);
      b
order: 1px solid var(--border);
      border-
radius: 6px;
      color: var(--text);
      
padding: 10px;
      font-family: inherit;
  
    font-size: 14px;
      resize: vertical;

      min-height: 80px;
      margin-top: 8px
;
    }
    
    .edit-field:focus {
      ou
tline: none;
      border-color: var(--accent
);
    }
    
    .field-label {
      font-s
ize: 12px;
      font-weight: 600;
      colo
r: var(--text-muted);
      text-transform: u
ppercase;
      letter-spacing: 0.5px;
      
margin-top: 16px;
      margin-bottom: 4px;
 
   }
    
    /* Contacts section */
    .con
tacts-section {
      margin-top: 16px;
     
 padding-top: 16px;
      border-top: 1px sol
id var(--border);
    }
    
    .contact-car
d {
      background: var(--bg);
      border
-radius: 6px;
      padding: 12px;
      marg
in-bottom: 8px;
      display: flex;
      ju
stify-content: space-between;
      align-ite
ms: center;
    }
    
    .contact-info {
  
    flex: 1;
    }
    
    .contact-name {
 
     font-weight: 600;
      font-size: 14px;

    }
    
    .contact-role {
      font-si
ze: 12px;
      color: var(--text-muted);
   
 }
    
    .contact-email {
      font-size:
 12px;
      color: var(--accent);
      text
-decoration: none;
    }
    
    .contact-em
ail:hover {
      text-decoration: underline;

    }
    
    .contact-remove {
      backg
round: none;
      border: none;
      color:
 var(--text-muted);
      cursor: pointer;
  
    font-size: 18px;
      padding: 4px 8px;

    }
    
    .contact-remove:hover {
      
color: var(--danger);
    }
    
    .add-con
tact-form {
      display: grid;
      grid-t
emplate-columns: 1fr 1fr 1fr auto;
      gap:
 8px;
      margin-top: 8px;
    }
    
    .
add-contact-form input {
      background: va
r(--bg);
      border: 1px solid var(--border
);
      border-radius: 4px;
      color: var
(--text);
      padding: 8px;
      font-size
: 13px;
    }
    
    .add-contact-form inpu
t:focus {
      outline: none;
      border-c
olor: var(--accent);
    }
    
    .add-cont
act-form input::placeholder {
      color: va
r(--text-muted);
    }
    
    .btn-small {

      padding: 8px 12px;
      font-size: 12p
x;
    }
    
    /* Accordion for messages *
/
    .accordion {
      margin-top: 16px;
  
    border-top: 1px solid var(--border);
    
  padding-top: 16px;
    }
    
    .accordio
n-header {
      display: flex;
      justify
-content: space-between;
      align-items: c
enter;
      cursor: pointer;
      padding: 
10px 0;
    }
    
    .accordion-header:hove
r {
      color: var(--accent);
    }
    
  
  .accordion-title {
      font-size: 12px;
 
     font-weight: 600;
      text-transform: 
uppercase;
      letter-spacing: 0.5px;
     
 display: flex;
      align-items: center;
  
    gap: 8px;
    }
    
    .accordion-icon 
{
      transition: transform 0.2s;
    }
   
 
    .accordion.open .accordion-icon {
     
 transform: rotate(180deg);
    }
    
    .a
ccordion-content {
      display: none;
     
 padding-top: 8px;
    }
    
    .accordion.
open .accordion-content {
      display: bloc
k;
    }
    
    .message-item {
      backg
round: var(--bg);
      border-radius: 6px;
 
     padding: 12px;
      margin-bottom: 8px;

      border-left: 3px solid var(--border);

    }
    
    .message-meta {
      display:
 flex;
      justify-content: space-between;

      align-items: center;
      margin-botto
m: 6px;
    }
    
    .message-date {
      
font-size: 11px;
      color: var(--text-mute
d);
    }
    
    .message-medium {
      fo
nt-size: 10px;
      padding: 2px 6px;
      
border-radius: 3px;
      text-transform: upp
ercase;
      font-weight: 600;
    }
    
  
  .message-medium.email { background: var(--a
ccent); }
    .message-medium.text { backgrou
nd: var(--success); }
    .message-medium.sla
ck { background: var(--purple); }
    .messag
e-medium.call { background: var(--warning); c
olor: #000; }
    .message-medium.meeting { b
ackground: var(--danger); }
    .message-medi
um.teams { background: #5c5cff; }
    
    .m
essage-text {
      font-size: 13px;
      li
ne-height: 1.5;
    }
    
    .add-message-f
orm {
      margin-top: 12px;
      padding-t
op: 12px;
      border-top: 1px solid var(--b
order);
    }
    
    .add-message-row {
   
   display: flex;
      gap: 8px;
      margi
n-bottom: 8px;
    }
    
    .add-message-ro
w select {
      background: var(--bg);
     
 border: 1px solid var(--border);
      borde
r-radius: 4px;
      color: var(--text);
    
  padding: 8px;
      font-size: 13px;
    }

    
    .add-message-row input[type="date"] 
{
      background: var(--bg);
      border: 
1px solid var(--border);
      border-radius:
 4px;
      color: var(--text);
      padding
: 8px;
      font-size: 13px;
    }
    
    
.message-input {
      width: 100%;
      bac
kground: var(--bg);
      border: 1px solid v
ar(--border);
      border-radius: 4px;
     
 color: var(--text);
      padding: 8px;
    
  font-family: inherit;
      font-size: 13px
;
      resize: vertical;
      min-height: 6
0px;
    }
    
    .message-input:focus {
  
    outline: none;
      border-color: var(--
accent);
    }
    
    .message-count {
    
  background: var(--surface-hover);
      pad
ding: 2px 8px;
      border-radius: 10px;
   
   font-size: 11px;
    }
    
    /* Attachm
ents */
    .attachments-section {
      marg
in-top: 16px;
      padding-top: 16px;
      
border-top: 1px solid var(--border);
    }
  
  
    .attachments-grid {
      display: gri
d;
      grid-template-columns: repeat(auto-f
ill, minmax(120px, 1fr));
      gap: 12px;
  
    margin-top: 8px;
    }
    
    .attachme
nt-item {
      position: relative;
      bor
der-radius: 8px;
      overflow: hidden;
    
  background: var(--bg);
      border: 1px so
lid var(--border);
    }
    
    .attachment
-item img {
      width: 100%;
      height: 
100px;
      object-fit: cover;
      cursor:
 pointer;
      transition: opacity 0.2s;
   
 }
    
    .attachment-item img:hover {
    
  opacity: 0.8;
    }
    
    .attachment-re
move {
      position: absolute;
      top: 4
px;
      right: 4px;
      background: var(-
-danger);
      color: white;
      border: n
one;
      border-radius: 50%;
      width: 2
0px;
      height: 20px;
      cursor: pointe
r;
      font-size: 12px;
      line-height: 
1;
      display: flex;
      align-items: ce
nter;
      justify-content: center;
    }
  
  
    .attachment-name {
      padding: 6px;

      font-size: 11px;
      color: var(--te
xt-muted);
      white-space: nowrap;
      o
verflow: hidden;
      text-overflow: ellipsi
s;
    }
    
    .attachment-empty {
      c
olor: var(--text-muted);
      font-size: 13p
x;
      padding: 12px;
      text-align: cen
ter;
      background: var(--bg);
      borde
r-radius: 8px;
    }
    
    /* Lightbox */

    .lightbox {
      position: fixed;
      
inset: 0;
      background: rgba(0,0,0,0.9);

      display: none;
      align-items: cente
r;
      justify-content: center;
      z-ind
ex: 200;
    }
    
    .lightbox.open {
    
  display: flex;
    }
    
    .lightbox img
 {
      max-width: 90%;
      max-height: 90
%;
      border-radius: 8px;
    }
    
    .
lightbox-close {
      position: absolute;
  
    top: 20px;
      right: 20px;
      backg
round: none;
      border: none;
      color:
 white;
      font-size: 36px;
      cursor: 
pointer;
    }

    @media (max-width: 600px)
 {
      .add-contact-form {
        grid-tem
plate-columns: 1fr;
      }
      .add-messag
e-row {
        flex-direction: column;
     
 }
    }
    
    /* Header actions */
    .h
eader-actions {
      display: flex;
      ga
p: 8px;
      align-items: center;
    }
    

    /* Sync status */
    .sync-status {
   
   font-size: 11px;
      color: var(--text-m
uted);
      margin-left: 8px;
    }
    
   
 .sync-status.syncing {
      color: var(--wa
rning);
    }
    
    .sync-status.success {

      color: var(--success);
    }
    
    
.sync-status.error {
      color: var(--dange
r);
    }
    
    /* Settings modal */
    .
settings-field {
      margin-bottom: 16px;
 
   }
    
    .settings-field label {
      d
isplay: block;
      font-size: 12px;
      f
ont-weight: 600;
      color: var(--text-mute
d);
      text-transform: uppercase;
      le
tter-spacing: 0.5px;
      margin-bottom: 6px
;
    }
    
    .settings-field input {
    
  width: 100%;
      background: var(--bg);
 
     border: 1px solid var(--border);
      b
order-radius: 6px;
      color: var(--text);

      padding: 10px;
      font-size: 14px;
 
   }
    
    .settings-field input:focus {
 
     outline: none;
      border-color: var(-
-accent);
    }
    
    .settings-help {
   
   font-size: 12px;
      color: var(--text-m
uted);
      margin-top: 6px;
      line-heig
ht: 1.5;
    }
    
    .settings-help a {
  
    color: var(--accent);
    }
    
    .tok
en-status {
      display: inline-flex;
     
 align-items: center;
      gap: 6px;
      f
ont-size: 12px;
      margin-top: 8px;
    }

    
    .token-status.valid {
      color: v
ar(--success);
    }
    
    .token-status.i
nvalid {
      color: var(--danger);
    }
  
  
    /* Last sync indicator */
    .last-sy
nc {
      font-size: 11px;
      color: var(
--text-muted);
      text-align: right;
     
 margin-top: 4px;
    }
  </style>
</head>
<b
ody>
  <div class="container">
    <header>
 
     <div>
        <h1>🎯 DAMB Plan</h1>
  
      <div class="subtitle">VP of Sales & Mar
keting | Start: Feb 23, 2026</div>
      </di
v>
      <div class="header-actions">
       
 <button class="btn btn-primary" onclick="syn
cToGitHub()" id="sync-btn">
          <span i
d="sync-icon">⬆️</span> Sync
        </bu
tton>
        <button class="btn" style="back
ground: var(--surface-hover);" onclick="openS
ettings()">⚙️</button>
      </div>
     
 <div class="stats">
        <div class="stat
">
          <div class="stat-value" id="days
-until">--</div>
          <div class="stat-l
abel">Days to Start</div>
        </div>
    
    <div class="stat">
          <div class="
stat-value" id="tasks-complete">--</div>
    
      <div class="stat-label">Complete</div>

        </div>
        <div class="stat">
   
       <div class="stat-value" id="tasks-tota
l">--</div>
          <div class="stat-label"
>Total Tasks</div>
        </div>
      </div
>
    </header>
    
    <div class="category
-filters" id="category-filters">
      <!-- P
opulated by JS -->
    </div>
    
    <div c
lass="filters">
      <button class="filter-b
tn active" data-filter="all">All</button>
   
   <button class="filter-btn" data-filter="ac
tive">Active</button>
      <button class="fi
lter-btn" data-filter="milestone">Milestones<
/button>
      <button class="filter-btn" dat
a-filter="deliverable">Deliverables</button>

      <button class="filter-btn" data-filter=
"task">Tasks</button>
      <button class="fi
lter-btn" data-filter="decision">Decisions</b
utton>
      <button class="filter-btn" data-
filter="pending">Pending</button>
      <butt
on class="filter-btn" data-filter="in-progres
s">In Progress</button>
      <button class="
filter-btn" data-filter="complete">Complete</
button>
    </div>
    
    <div class="panel
 timeline-container" style="margin-bottom: 24
px;">
      <div class="timeline">
        <d
iv class="timeline-header" id="timeline-phase
s"></div>
        <div class="timeline-track"
>
          <div class="timeline-progress" id
="timeline-progress"></div>
          <div cl
ass="timeline-today" id="timeline-today"></di
v>
        </div>
      </div>
    </div>
   
 
    <div class="main-grid">
      <div clas
s="task-area">
        <div id="task-groups">
</div>
      </div>
      
      <div class="
sidebar">
        <div class="panel" style="m
argin-bottom: 24px;">
          <div class="p
anel-title">📅 Today's Focus</div>
        
  <div id="focus-today"></div>
        </div>

        
        <div class="panel" style="m
argin-bottom: 24px;">
          <div class="p
anel-title">⚡ Coming Up</div>
          <di
v id="focus-upcoming"></div>
        </div>
 
       
        <div class="panel">
         
 <div class="panel-title">🔗 Key Dependenci
es</div>
          <div class="dep-graph" id=
"dependencies"></div>
        </div>
      </
div>
    </div>
  </div>
  
  <!-- Settings M
odal -->
  <div class="modal-overlay" id="set
tings-modal">
    <div class="modal">
      <
button class="modal-close" onclick="closeSett
ings()">&times;</button>
      <h2>⚙️ Set
tings</h2>
      
      <div class="settings-
field">
        <label>GitHub Personal Access
 Token</label>
        <input type="password"
 id="github-token" placeholder="ghp_xxxxxxxxx
xxx">
        <div class="settings-help">
   
       Required for syncing edits across devi
ces.<br>
          <a href="https://github.co
m/settings/tokens/new?description=90-Day-Plan
-Sync&scopes=repo" target="_blank">Create a t
oken</a> with <strong>repo</strong> scope.
  
      </div>
        <div class="token-status
" id="token-status"></div>
      </div>
     
 
      <div class="settings-field">
        
<label>Repository</label>
        <input type
="text" id="github-repo" value="ADI2D/special
-strong-90day" readonly style="opacity: 0.7;"
>
      </div>
      
      <div class="last-
sync" id="last-sync-display"></div>
      
  
    <div class="modal-actions">
        <butt
on class="btn btn-primary" onclick="saveSetti
ngs()">Save Settings</button>
        <button
 class="btn" style="background: var(--surface
-hover);" onclick="testToken()">Test Connecti
on</button>
      </div>
    </div>
  </div>


  <!-- Lightbox for full-size images -->
  <
div class="lightbox" id="lightbox" onclick="c
loseLightbox()">
    <button class="lightbox-
close">&times;</button>
    <img id="lightbox
-img" src="" alt="Attachment">
  </div>

  <d
iv class="modal-overlay" id="modal">
    <div
 class="modal">
      <button class="modal-cl
ose" onclick="closeModal()">&times;</button>

      <h2 id="modal-title"></h2>
      <div i
d="modal-content"></div>
      
      <!-- No
tes Section -->
      <div class="field-label
">Notes</div>
      <textarea class="edit-fie
ld" id="notes-field" placeholder="Add notes..
."></textarea>
      
      <!-- Attachments 
Section -->
      <div class="attachments-sec
tion">
        <div class="field-label">📎 
Attachments</div>
        <div id="attachment
s-list"></div>
      </div>
      
      <!--
 Contacts Section -->
      <div class="conta
cts-section">
        <div class="field-label
">Contacts</div>
        <div id="contacts-li
st"></div>
        <div class="add-contact-fo
rm">
          <input type="text" id="contact
-name" placeholder="Name">
          <input t
ype="text" id="contact-role" placeholder="Rol
e">
          <input type="email" id="contact
-email" placeholder="Email">
          <butto
n class="btn btn-primary btn-small" onclick="
addContact()">+</button>
        </div>
     
 </div>
      
      <!-- Messages Accordion 
-->
      <div class="accordion" id="messages
-accordion">
        <div class="accordion-he
ader" onclick="toggleAccordion()">
          
<span class="accordion-title">
            �
�� Message History
            <span class="m
essage-count" id="message-count">0</span>
   
       </span>
          <span class="accordi
on-icon">▼</span>
        </div>
        <d
iv class="accordion-content">
          <div 
id="messages-list"></div>
          <div clas
s="add-message-form">
            <div class=
"add-message-row">
              <input type=
"date" id="message-date">
              <sele
ct id="message-medium">
                <opti
on value="email">Email</option>
             
   <option value="text">Text</option>
       
         <option value="slack">Slack</option>

                <option value="teams">Teams<
/option>
                <option value="call"
>Call</option>
                <option value=
"meeting">Meeting</option>
              </se
lect>
            </div>
            <textare
a class="message-input" id="message-text" pla
ceholder="Add message summary..."></textarea>

            <button class="btn btn-primary b
tn-small" style="margin-top: 8px;" onclick="a
ddMessage()">Add Message</button>
          <
/div>
        </div>
      </div>
      
    
  <div class="modal-actions">
        <button
 class="btn btn-primary" onclick="saveChanges
()">Save Changes</button>
        <button cla
ss="btn btn-success" onclick="toggleStatus()"
>Toggle Status</button>
      </div>
    </di
v>
  </div>

  <script>
    let data = null;

    let currentFilter = 'all';
    let curren
tCategory = 'all';
    let selectedTask = nul
l;
    let localData = {}; // For storing edi
ts in localStorage
    let categoryMap = {}; 
// Quick lookup for categories
    
    const
 STORAGE_KEY = 'special-strong-90day-local';

    const SETTINGS_KEY = 'special-strong-90da
y-settings';
    const GITHUB_REPO = 'ADI2D/s
pecial-strong-90day';
    const DATA_FILE = '
data.json';
    
    // Settings management
 
   function getSettings() {
      try {
     
   const stored = localStorage.getItem(SETTIN
GS_KEY);
        return stored ? JSON.parse(s
tored) : {};
      } catch (e) {
        retu
rn {};
      }
    }
    
    function saveSe
ttingsToStorage(settings) {
      localStorag
e.setItem(SETTINGS_KEY, JSON.stringify(settin
gs));
    }
    
    function loadLocalData()
 {
      try {
        const stored = localSt
orage.getItem(STORAGE_KEY);
        if (store
d) {
          localData = JSON.parse(stored)
;
        }
      } catch (e) {
        conso
le.error('Failed to load local data:', e);
  
      localData = {};
      }
    }
    
    
function saveLocalData() {
      try {
      
  localStorage.setItem(STORAGE_KEY, JSON.stri
ngify(localData));
      } catch (e) {
      
  console.error('Failed to save local data:',
 e);
      }
    }
    
    function getTaskL
ocalData(taskId) {
      if (!localData[taskI
d]) {
        localData[taskId] = {
         
 notes: '',
          contacts: [],
         
 messages: [],
          attachments: [],
   
       status: null
        };
      }
      
// Ensure attachments array exists for older 
data
      if (!localData[taskId].attachments
) {
        localData[taskId].attachments = [
];
      }
      return localData[taskId];
  
  }
    
    async function loadData() {
    
  loadLocalData();
      updateLastSyncDispla
y();
      
      try {
        // Try to fet
ch with cache-busting
        const resp = aw
ait fetch('data.json?t=' + Date.now());
     
   data = await resp.json();
        
       
 // Apply userData from data.json if present 
(synced data)
        if (data.userData) {
  
        // Merge remote userData into localDa
ta (remote wins for conflicts)
          Obje
ct.keys(data.userData).forEach(taskId => {
  
          if (!localData[taskId]) {
         
     localData[taskId] = data.userData[taskId
];
            } else {
              // Merg
e: remote data takes precedence but keep loca
l additions
              const remote = data
.userData[taskId];
              const local 
= localData[taskId];
              localData[
taskId] = {
                notes: remote.not
es || local.notes,
                contacts: 
remote.contacts || local.contacts || [],
    
            messages: remote.messages || loca
l.messages || [],
                status: rem
ote.status || local.status
              };
 
           }
          });
          saveLoca
lData();
        }
        
        // Apply 
local data to tasks
        data.tasks.forEac
h(task => {
          const local = localData
[task.id];
          if (local) {
           
 if (local.status) task.status = local.status
;
            if (local.notes) task.localNote
s = local.notes;
          }
        });
    
    
        render();
      } catch (e) {
  
      console.error('Failed to load data:', e
);
        document.getElementById('task-grou
ps').innerHTML = 
          '<div class="empt
y-state">Failed to load data.json</div>';
   
   }
    }
    
    // Settings Modal
    fun
ction openSettings() {
      const settings =
 getSettings();
      document.getElementById
('github-token').value = settings.token || ''
;
      document.getElementById('settings-mod
al').classList.add('open');
      updateLastS
yncDisplay();
    }
    
    function closeSe
ttings() {
      document.getElementById('set
tings-modal').classList.remove('open');
    }

    
    function saveSettings() {
      con
st token = document.getElementById('github-to
ken').value.trim();
      saveSettingsToStora
ge({ token, lastSync: getSettings().lastSync 
});
      alert('Settings saved!');
      clo
seSettings();
    }
    
    async function t
estToken() {
      const token = document.get
ElementById('github-token').value.trim();
   
   const statusEl = document.getElementById('
token-status');
      
      if (!token) {
  
      statusEl.className = 'token-status inva
lid';
        statusEl.textContent = '❌ No 
token entered';
        return;
      }
     
 
      statusEl.className = 'token-status';

      statusEl.textContent = '⏳ Testing...'
;
      
      try {
        const resp = awa
it fetch(`https://api.github.com/repos/${GITH
UB_REPO}`, {
          headers: {
           
 'Authorization': `token ${token}`,
         
   'Accept': 'application/vnd.github.v3+json'

          }
        });
        
        if 
(resp.ok) {
          const data = await resp
.json();
          if (data.permissions && da
ta.permissions.push) {
            statusEl.c
lassName = 'token-status valid';
            
statusEl.textContent = '✅ Connected with wr
ite access';
          } else {
            s
tatusEl.className = 'token-status invalid';
 
           statusEl.textContent = '⚠️ Con
nected but no write access';
          }
    
    } else {
          statusEl.className = '
token-status invalid';
          statusEl.tex
tContent = '❌ Invalid token or no repo acce
ss';
        }
      } catch (e) {
        st
atusEl.className = 'token-status invalid';
  
      statusEl.textContent = '❌ Connection 
failed';
      }
    }
    
    function upda
teLastSyncDisplay() {
      const settings = 
getSettings();
      const el = document.getE
lementById('last-sync-display');
      if (se
ttings.lastSync) {
        const date = new D
ate(settings.lastSync);
        el.textConten
t = `Last synced: ${date.toLocaleDateString()
} ${date.toLocaleTimeString()}`;
      } else
 {
        el.textContent = 'Never synced';
 
     }
    }
    
    // GitHub Sync
    asyn
c function syncToGitHub() {
      const setti
ngs = getSettings();
      const token = sett
ings.token;
      
      if (!token) {
      
  openSettings();
        alert('Please add y
our GitHub token first');
        return;
   
   }
      
      const syncBtn = document.ge
tElementById('sync-btn');
      const syncIco
n = document.getElementById('sync-icon');
   
   syncBtn.disabled = true;
      syncIcon.te
xtContent = '🔄';
      
      try {
      
  // Get current file SHA (needed for update)

        const fileResp = await fetch(`https:
//api.github.com/repos/${GITHUB_REPO}/content
s/${DATA_FILE}`, {
          headers: {
     
       'Authorization': `token ${token}`,
   
         'Accept': 'application/vnd.github.v3
+json'
          }
        });
        
     
   if (!fileResp.ok) {
          throw new Er
ror('Failed to get current file');
        }

        
        const fileData = await fileR
esp.json();
        const currentSha = fileDa
ta.sha;
        
        // Decode current co
ntent
        const currentContent = JSON.par
se(atob(fileData.content));
        
        
// Merge localData into userData
        curr
entContent.userData = localData;
        
   
     // Encode new content
        const newC
ontent = btoa(unescape(encodeURIComponent(JSO
N.stringify(currentContent, null, 2))));
    
    
        // Update file
        const upd
ateResp = await fetch(`https://api.github.com
/repos/${GITHUB_REPO}/contents/${DATA_FILE}`,
 {
          method: 'PUT',
          headers
: {
            'Authorization': `token ${tok
en}`,
            'Accept': 'application/vnd.
github.v3+json',
            'Content-Type': 
'application/json'
          },
          bod
y: JSON.stringify({
            message: `Syn
c user data - ${new Date().toISOString()}`,
 
           content: newContent,
            s
ha: currentSha
          })
        });
     
   
        if (!updateResp.ok) {
          c
onst err = await updateResp.json();
         
 throw new Error(err.message || 'Failed to up
date file');
        }
        
        // Up
date last sync time
        settings.lastSync
 = Date.now();
        saveSettingsToStorage(
settings);
        updateLastSyncDisplay();
 
       
        syncIcon.textContent = '✅';

        setTimeout(() => { syncIcon.textCont
ent = '⬆️'; }, 2000);
        
      } ca
tch (e) {
        console.error('Sync failed:
', e);
        alert('Sync failed: ' + e.mess
age);
        syncIcon.textContent = '❌';
 
       setTimeout(() => { syncIcon.textConten
t = '⬆️'; }, 2000);
      } finally {
   
     syncBtn.disabled = false;
      }
    }

    
    function formatDate(dateStr) {
     
 const d = new Date(dateStr + 'T00:00:00');
 
     return d.toLocaleDateString('en-US', { m
onth: 'short', day: 'numeric' });
    }
    

    function daysBetween(d1, d2) {
      cons
t date1 = new Date(d1 + 'T00:00:00');
      c
onst date2 = new Date(d2 + 'T00:00:00');
    
  return Math.ceil((date2 - date1) / (1000 * 
60 * 60 * 24));
    }
    
    function getTo
day() {
      return new Date().toISOString()
.split('T')[0];
    }
    
    function rende
r() {
      buildCategoryMap();
      renderC
ategoryFilters();
      renderStats();
      
renderTimeline();
      renderTasks();
      
renderFocus();
      renderDependencies();
  
  }
    
    function buildCategoryMap() {
  
    categoryMap = {};
      if (data.categori
es) {
        data.categories.forEach(cat => 
{
          categoryMap[cat.id] = cat;
      
  });
      }
    }
    
    function getCate
goryInfo(categoryId) {
      return categoryM
ap[categoryId] || { name: categoryId, color: 
'#6b7280', icon: '📁' };
    }
    
    fun
ction getSubcategoryName(categoryId, subcateg
oryId) {
      const cat = categoryMap[catego
ryId];
      if (cat && cat.subcategories) {

        const sub = cat.subcategories.find(s 
=> s.id === subcategoryId);
        return su
b ? sub.name : subcategoryId;
      }
      r
eturn subcategoryId || '';
    }
    
    fun
ction renderCategoryFilters() {
      const c
ontainer = document.getElementById('category-
filters');
      if (!data.categories || data
.categories.length === 0) {
        container
.style.display = 'none';
        return;
    
  }
      
      let html = `<button class="c
ategory-filter-btn ${currentCategory === 'all
' ? 'active' : ''}" 
                        
  data-category="all" 
                      
    style="background: var(--surface-hover); 
color: var(--text);">
                    All
 Categories
                  </button>`;
   
   
      data.categories.forEach(cat => {
  
      html += `<button class="category-filter
-btn ${currentCategory === cat.id ? 'active' 
: ''}" 
                         data-categor
y="${cat.id}"
                         style=
"background: ${cat.color}22; color: ${cat.col
or}; border-color: ${cat.color};">
          
         ${cat.icon} ${cat.name}
            
     </button>`;
      });
      
      conta
iner.innerHTML = html;
      
      // Add cl
ick handlers
      container.querySelectorAll
('.category-filter-btn').forEach(btn => {
   
     btn.addEventListener('click', () => {
  
        currentCategory = btn.dataset.categor
y;
          renderCategoryFilters();
       
   renderTasks();
        });
      });
    }

    
    function renderStats() {
      cons
t today = getToday();
      const startDate =
 data.meta.startDate;
      const daysUntil =
 daysBetween(today, startDate);
      
      
document.getElementById('days-until').textCon
tent = 
        daysUntil > 0 ? daysUntil : (
daysUntil === 0 ? 'TODAY!' : `Day ${Math.abs(
daysUntil)}`);
      
      const complete = 
data.tasks.filter(t => t.status === 'complete
').length;
      document.getElementById('tas
ks-complete').textContent = complete;
      d
ocument.getElementById('tasks-total').textCon
tent = data.tasks.length;
    }
    
    func
tion renderTimeline() {
      const phasesEl 
= document.getElementById('timeline-phases');

      phasesEl.innerHTML = data.phases.map(p
 => 
        `<div class="timeline-phase" sty
le="background: ${p.color}20; color: ${p.colo
r};">
          ${p.name}<br><small>${formatD
ate(p.startDate)} - ${formatDate(p.endDate)}<
/small>
        </div>`
      ).join('');
   
   
      // Calculate progress
      const t
oday = getToday();
      const totalStart = n
ew Date(data.phases[0].startDate + 'T00:00:00
');
      const totalEnd = new Date(data.phas
es[data.phases.length - 1].endDate + 'T00:00:
00');
      const todayDate = new Date(today 
+ 'T00:00:00');
      
      const totalDays 
= (totalEnd - totalStart) / (1000 * 60 * 60 *
 24);
      const elapsedDays = Math.max(0, (
todayDate - totalStart) / (1000 * 60 * 60 * 2
4));
      const progressPct = Math.min(100, 
(elapsedDays / totalDays) * 100);
      
    
  document.getElementById('timeline-progress'
).style.width = progressPct + '%';
      docu
ment.getElementById('timeline-today').style.l
eft = progressPct + '%';
    }
    
    funct
ion filterTasks(tasks) {
      let filtered =
 tasks;
      
      // Category filter
     
 if (currentCategory !== 'all') {
        fil
tered = filtered.filter(t => t.category === c
urrentCategory);
      }
      
      // Type
/status filter
      if (currentFilter !== 'a
ll') {
        if (currentFilter === 'active'
) {
          filtered = filtered.filter(t =>
 t.status !== 'complete');
        } else if 
(['milestone', 'deliverable', 'task', 'decisi
on'].includes(currentFilter)) {
          fil
tered = filtered.filter(t => t.type === curre
ntFilter);
        } else if (['pending', 'in
-progress', 'complete'].includes(currentFilte
r)) {
          filtered = filtered.filter(t 
=> t.status === currentFilter);
        }
   
   }
      
      return filtered;
    }
    

    function renderTasks() {
      const gro
upsEl = document.getElementById('task-groups'
);
      const today = getToday();
      
   
   let html = '';
      
      data.phases.fo
rEach(phase => {
        const phaseTasks = f
ilterTasks(data.tasks.filter(t => t.phase ===
 phase.id));
        if (phaseTasks.length ==
= 0) return;
        
        html += `
     
     <div class="phase-group">
            <d
iv class="phase-header">
              <div c
lass="phase-indicator" style="background: ${p
hase.color}"></div>
              <span class
="phase-name">${phase.name}</span>
          
    <span class="phase-dates">${formatDate(ph
ase.startDate)} - ${formatDate(phase.endDate)
}</span>
            </div>
            <div 
class="task-list">
              ${phaseTasks
.map(task => {
                const isOverdu
e = task.dueDate && task.dueDate < today && t
ask.status !== 'complete';
                co
nst catInfo = getCategoryInfo(task.category);

                const subName = getSubcatego
ryName(task.category, task.subcategory);
    
            return `
                  <div c
lass="task-card ${task.status} ${isOverdue ? 
'overdue' : ''}" 
                       oncl
ick="openTask('${task.id}')"
                
       style="border-left-color: ${task.statu
s === 'complete' ? 'var(--success)' : task.st
atus === 'in-progress' ? 'var(--warning)' : c
atInfo.color};">
                    <div cla
ss="category-row">
                      <spa
n class="task-category" style="background: ${
catInfo.color}22; color: ${catInfo.color};">

                        ${catInfo.icon} ${cat
Info.name}
                      </span>
    
                  ${subName ? `<span class="t
ask-subcategory">${subName}</span>` : ''}
   
                 </div>
                    <
div class="task-header">
                    
  <span class="task-title">${task.title}</spa
n>
                      <span class="task-ty
pe ${task.type}">${task.type}</span>
        
            </div>
                    <div c
lass="task-meta">
                      <span
 class="status ${task.status}">
             
           <span class="status-dot"></span>
 
                       ${task.status.replace(
'-', ' ')}
                      </span>
    
                  ${task.dueDate ? `<span>Due
: ${formatDate(task.dueDate)}</span>` : ''}
 
                     <span>Owner: ${task.owne
r}</span>
                    </div>
        
            ${task.notes ? `<div class="task-
notes">${task.notes}</div>` : ''}
           
       </div>
                `;
            
  }).join('')}
            </div>
          <
/div>
        `;
      });
      
      group
sEl.innerHTML = html || '<div class="empty-st
ate">No tasks match this filter</div>';
    }

    
    function renderFocus() {
      cons
t today = getToday();
      const todayEl = d
ocument.getElementById('focus-today');
      
const upcomingEl = document.getElementById('f
ocus-upcoming');
      
      // Tasks due to
day or overdue
      const urgent = data.task
s.filter(t => 
        t.status !== 'complete
' && t.dueDate && t.dueDate <= today
      );

      
      // Tasks due in next 7 days
   
   const nextWeek = new Date();
      nextWee
k.setDate(nextWeek.getDate() + 7);
      cons
t nextWeekStr = nextWeek.toISOString().split(
'T')[0];
      
      const upcoming = data.t
asks.filter(t => 
        t.status !== 'compl
ete' && t.dueDate && t.dueDate > today && t.d
ueDate <= nextWeekStr
      ).slice(0, 5);
  
    
      if (urgent.length === 0) {
       
 todayEl.innerHTML = '<div class="focus-item"
>✅ No urgent items</div>';
      } else {
 
       todayEl.innerHTML = urgent.map(t => {

          const catInfo = getCategoryInfo(t.c
ategory);
          return `
            <div
 class="focus-item urgent" style="border-left
-color: ${catInfo.color};">
              <sp
an class="task-category" style="background: $
{catInfo.color}22; color: ${catInfo.color}; f
ont-size: 10px; padding: 1px 6px; margin-bott
om: 4px; display: inline-block;">
           
     ${catInfo.icon} ${catInfo.name}
        
      </span>
              <div><strong>${t.
title}</strong></div>
              <div clas
s="countdown">${t.dueDate === today ? 'Due to
day' : 'Overdue: ' + formatDate(t.dueDate)}</
div>
            </div>
          `;
        
}).join('');
      }
      
      if (upcomin
g.length === 0) {
        upcomingEl.innerHTM
L = '<div class="focus-item">No items in next
 7 days</div>';
      } else {
        upcomi
ngEl.innerHTML = upcoming.map(t => {
        
  const catInfo = getCategoryInfo(t.category)
;
          return `
            <div class="
focus-item soon" style="border-left-color: ${
catInfo.color};">
              <span class="
task-category" style="background: ${catInfo.c
olor}22; color: ${catInfo.color}; font-size: 
10px; padding: 1px 6px; margin-bottom: 4px; d
isplay: inline-block;">
                ${cat
Info.icon} ${catInfo.name}
              </sp
an>
              <div><strong>${t.title}</st
rong></div>
              <div class="countdo
wn">${formatDate(t.dueDate)} (${daysBetween(t
oday, t.dueDate)} days)</div>
            </d
iv>
          `;
        }).join('');
      }

    }
    
    function renderDependencies()
 {
      const depEl = document.getElementByI
d('dependencies');
      
      // Find tasks
 with dependencies
      const withDeps = dat
a.tasks.filter(t => t.dependencies && t.depen
dencies.length > 0).slice(0, 8);
      
     
 if (withDeps.length === 0) {
        depEl.i
nnerHTML = '<div class="focus-item">No depend
encies tracked</div>';
        return;
      
}
      
      depEl.innerHTML = withDeps.map
(t => {
        const depNames = t.dependenci
es.map(depId => {
          const dep = data.
tasks.find(x => x.id === depId);
          re
turn dep ? dep.title.substring(0, 30) + (dep.
title.length > 30 ? '...' : '') : depId;
    
    });
        return `
          <div class
="dep-item">
            <span style="flex:1"
>${t.title.substring(0, 25)}${t.title.length 
> 25 ? '...' : ''}</span>
            <span c
lass="dep-arrow">←</span>
            <span
 style="color: var(--text-muted); font-size: 
11px;">${depNames[0]}</span>
          </div>

        `;
      }).join('');
    }
    
   
 function openTask(id) {
      selectedTask =
 data.tasks.find(t => t.id === id);
      if 
(!selectedTask) return;
      
      const ta
skLocal = getTaskLocalData(id);
      
      
document.getElementById('modal-title').textCo
ntent = selectedTask.title;
      
      cons
t deps = (selectedTask.dependencies || []).ma
p(depId => {
        const dep = data.tasks.f
ind(x => x.id === depId);
        return dep 
? dep.title : depId;
      });
      
      c
onst blockedBy = data.tasks.filter(t => 
    
    (t.dependencies || []).includes(selectedT
ask.id)
      ).map(t => t.title);
      
   
   const catInfo = getCategoryInfo(selectedTa
sk.category);
      const subName = getSubcat
egoryName(selectedTask.category, selectedTask
.subcategory);
      
      document.getEleme
ntById('modal-content').innerHTML = `
       
 <div class="category-row" style="margin-bott
om: 16px;">
          <span class="task-categ
ory" style="background: ${catInfo.color}22; c
olor: ${catInfo.color}; font-size: 13px; padd
ing: 4px 12px;">
            ${catInfo.icon} 
${catInfo.name}
          </span>
          $
{subName ? `<span class="task-subcategory" st
yle="font-size: 12px; padding: 4px 10px;">${s
ubName}</span>` : ''}
        </div>
        
<p><strong>Type:</strong> ${selectedTask.type
}</p>
        <p><strong>Status:</strong> <sp
an class="status ${selectedTask.status}"><spa
n class="status-dot"></span> ${selectedTask.s
tatus.replace('-', ' ')}</span></p>
        <
p><strong>Owner:</strong> ${selectedTask.owne
r}</p>
        ${selectedTask.dueDate ? `<p><
strong>Due:</strong> ${formatDate(selectedTas
k.dueDate)}</p>` : ''}
        ${deps.length 
? `<p><strong>Depends on:</strong> ${deps.joi
n(', ')}</p>` : ''}
        ${blockedBy.lengt
h ? `<p><strong>Blocks:</strong> ${blockedBy.
join(', ')}</p>` : ''}
      `;
      
      
// Set notes (combine base notes + local note
s)
      const baseNotes = selectedTask.notes
 || '';
      const localNotes = taskLocal.no
tes || '';
      document.getElementById('not
es-field').value = localNotes || baseNotes;
 
     
      // Render attachments (merge from
 data.json and localStorage, respecting hidde
n)
      const baseAttachments = (selectedTas
k.attachments || []).filter(a => 
        !(t
askLocal.hiddenAttachments || []).includes(a.
path)
      );
      const localAttachments =
 taskLocal.attachments || [];
      // Combin
e, avoiding duplicates by path
      const ex
istingPaths = new Set(baseAttachments.map(a =
> a.path));
      const mergedAttachments = [
...baseAttachments, ...localAttachments.filte
r(a => !existingPaths.has(a.path))];
      re
nderAttachments(mergedAttachments);
      
  
    // Render contacts
      renderContacts(t
askLocal.contacts || []);
      
      // Ren
der messages
      renderMessages(taskLocal.m
essages || []);
      
      // Set default d
ate for new message
      document.getElement
ById('message-date').value = getToday();
    
  
      // Reset accordion state
      docum
ent.getElementById('messages-accordion').clas
sList.remove('open');
      
      document.g
etElementById('modal').classList.add('open');

    }
    
    function renderAttachments(at
tachments) {
      const container = document
.getElementById('attachments-list');
      
 
     let html = '';
      
      if (attachme
nts && attachments.length > 0) {
        html
 += `<div class="attachments-grid">
         
 ${attachments.map((att, idx) => `
          
  <div class="attachment-item">
             
 <img src="${escapeHtml(att.path)}" alt="${es
capeHtml(att.name || 'Attachment')}" 
       
            onclick="openLightbox('${escapeHt
ml(att.path)}')" 
                   onerror=
"this.src='data:image/svg+xml,<svg xmlns=%22h
ttp://www.w3.org/2000/svg%22 width=%22100%22 
height=%22100%22><rect fill=%22%23334155%22 w
idth=%22100%22 height=%22100%22/><text x=%225
0%22 y=%2255%22 text-anchor=%22middle%22 fill
=%22%2394a3b8%22 font-size=%2212%22>Error</te
xt></svg>'">
              <button class="att
achment-remove" onclick="removeAttachment(${i
dx})">&times;</button>
              <div cla
ss="attachment-name">${escapeHtml(att.name ||
 att.path.split('/').pop())}</div>
          
  </div>
          `).join('')}
        </div
>`;
      } else {
        html += '<div clas
s="attachment-empty">No attachments</div>';
 
     }
      
      // Add attachment form
  
    html += `
        <div class="add-attachm
ent-form" style="margin-top: 12px;">
        
  <div style="display: flex; gap: 8px; margin
-bottom: 8px;">
            <input type="text
" id="attachment-name" placeholder="Name (opt
ional)" 
                   style="flex: 1; b
ackground: var(--bg); border: 1px solid var(-
-border); border-radius: 4px; color: var(--te
xt); padding: 8px; font-size: 13px;">
       
     <input type="text" id="attachment-path" 
placeholder="Image URL or path" 
            
       style="flex: 2; background: var(--bg);
 border: 1px solid var(--border); border-radi
us: 4px; color: var(--text); padding: 8px; fo
nt-size: 13px;">
            <button class="b
tn btn-primary btn-small" onclick="addAttachm
ent()">+ Add</button>
          </div>
      
    <div style="font-size: 11px; color: var(-
-text-muted);">
            Paste an image UR
L or relative path (e.g., attachments/photo.j
pg)
          </div>
        </div>`;
      

      container.innerHTML = html;
    }
    

    function addAttachment() {
      if (!sel
ectedTask) return;
      
      const name = 
document.getElementById('attachment-name').va
lue.trim();
      const path = document.getEl
ementById('attachment-path').value.trim();
  
    
      if (!path) {
        alert('Please
 enter an image URL or path');
        return
;
      }
      
      const taskLocal = getT
askLocalData(selectedTask.id);
      if (!tas
kLocal.attachments) taskLocal.attachments = [
];
      
      taskLocal.attachments.push({ 

        name: name || path.split('/').pop(),
 
        path: path 
      });
      saveLoc
alData();
      
      // Clear inputs
      
document.getElementById('attachment-name').va
lue = '';
      document.getElementById('atta
chment-path').value = '';
      
      render
Attachments(taskLocal.attachments);
    }
   
 
    function openLightbox(src) {
      docu
ment.getElementById('lightbox-img').src = src
;
      document.getElementById('lightbox').c
lassList.add('open');
    }
    
    function
 closeLightbox() {
      document.getElementB
yId('lightbox').classList.remove('open');
   
 }
    
    function removeAttachment(idx) {

      if (!selectedTask) return;
      
     
 // Get merged attachments (same logic as ren
dering)
      const baseAttachments = selecte
dTask.attachments || [];
      const taskLoca
l = getTaskLocalData(selectedTask.id);
      
const localAttachments = taskLocal.attachment
s || [];
      const existingPaths = new Set(
baseAttachments.map(a => a.path));
      cons
t mergedAttachments = [...baseAttachments, ..
.localAttachments.filter(a => !existingPaths.
has(a.path))];
      
      if (idx < 0 || id
x >= mergedAttachments.length) return;
      

      const toRemove = mergedAttachments[idx
];
      
      // If it's a base attachment 
(from data.json), track it as hidden
      if
 (idx < baseAttachments.length) {
        if 
(!taskLocal.hiddenAttachments) taskLocal.hidd
enAttachments = [];
        taskLocal.hiddenA
ttachments.push(toRemove.path);
      } else 
{
        // It's a local attachment, remove 
it directly
        const localIdx = idx - ba
seAttachments.length;
        if (taskLocal.a
ttachments && taskLocal.attachments[localIdx]
 !== undefined) {
          taskLocal.attachm
ents.splice(localIdx, 1);
        }
      }
 
     
      saveLocalData();
      
      // 
Re-render with updated data
      const newBa
seAttachments = baseAttachments.filter(a => 

        !(taskLocal.hiddenAttachments || []).
includes(a.path)
      );
      const newLoca
lAttachments = taskLocal.attachments || [];
 
     const newExistingPaths = new Set(newBase
Attachments.map(a => a.path));
      const ne
wMergedAttachments = [...newBaseAttachments, 
...newLocalAttachments.filter(a => !newExisti
ngPaths.has(a.path))];
      
      renderAtt
achments(newMergedAttachments);
    }
    
  
  function renderContacts(contacts) {
      c
onst container = document.getElementById('con
tacts-list');
      if (contacts.length === 0
) {
        container.innerHTML = '<div style
="color: var(--text-muted); font-size: 13px; 
margin-bottom: 8px;">No contacts added</div>'
;
        return;
      }
      
      contai
ner.innerHTML = contacts.map((c, idx) => `
  
      <div class="contact-card">
          <d
iv class="contact-info">
            <div cla
ss="contact-name">${escapeHtml(c.name)}</div>

            ${c.role ? `<div class="contact-
role">${escapeHtml(c.role)}</div>` : ''}
    
        ${c.email ? `<a href="mailto:${escape
Html(c.email)}" class="contact-email">${escap
eHtml(c.email)}</a>` : ''}
          </div>
 
         <button class="contact-remove" oncli
ck="removeContact(${idx})">&times;</button>
 
       </div>
      `).join('');
    }
    
 
   function renderMessages(messages) {
      
const container = document.getElementById('me
ssages-list');
      const countEl = document
.getElementById('message-count');
      count
El.textContent = messages.length;
      
    
  if (messages.length === 0) {
        contai
ner.innerHTML = '<div style="color: var(--tex
t-muted); font-size: 13px;">No messages logge
d</div>';
        return;
      }
      
    
  // Sort by date descending (newest first)
 
     const sorted = [...messages].sort((a, b)
 => new Date(b.date) - new Date(a.date));
   
   
      container.innerHTML = sorted.map((m
, idx) => `
        <div class="message-item"
>
          <div class="message-meta">
      
      <span class="message-date">${formatDate
(m.date)}</span>
            <span class="mes
sage-medium ${m.medium}">${m.medium}</span>
 
         </div>
          <div class="message
-text">${escapeHtml(m.text)}</div>
        </
div>
      `).join('');
    }
    
    functi
on escapeHtml(str) {
      if (!str) return '
';
      return str.replace(/&/g, '&amp;')
  
              .replace(/</g, '&lt;')
        
        .replace(/>/g, '&gt;')
              
  .replace(/"/g, '&quot;')
                .r
eplace(/'/g, '&#039;');
    }
    
    functi
on addContact() {
      if (!selectedTask) re
turn;
      
      const name = document.getE
lementById('contact-name').value.trim();
    
  const role = document.getElementById('conta
ct-role').value.trim();
      const email = d
ocument.getElementById('contact-email').value
.trim();
      
      if (!name) {
        al
ert('Please enter a name');
        return;
 
     }
      
      const taskLocal = getTask
LocalData(selectedTask.id);
      if (!taskLo
cal.contacts) taskLocal.contacts = [];
      

      taskLocal.contacts.push({ name, role, 
email });
      saveLocalData();
      
     
 // Clear inputs
      document.getElementByI
d('contact-name').value = '';
      document.
getElementById('contact-role').value = '';
  
    document.getElementById('contact-email').
value = '';
      
      renderContacts(taskL
ocal.contacts);
    }
    
    function remov
eContact(idx) {
      if (!selectedTask) retu
rn;
      
      const taskLocal = getTaskLoc
alData(selectedTask.id);
      if (taskLocal.
contacts && taskLocal.contacts[idx] !== undef
ined) {
        taskLocal.contacts.splice(idx
, 1);
        saveLocalData();
        render
Contacts(taskLocal.contacts);
      }
    }
 
   
    function addMessage() {
      if (!se
lectedTask) return;
      
      const date =
 document.getElementById('message-date').valu
e;
      const medium = document.getElementBy
Id('message-medium').value;
      const text 
= document.getElementById('message-text').val
ue.trim();
      
      if (!text) {
        
alert('Please enter a message');
        retu
rn;
      }
      
      const taskLocal = ge
tTaskLocalData(selectedTask.id);
      if (!t
askLocal.messages) taskLocal.messages = [];
 
     
      taskLocal.messages.push({ date: d
ate || getToday(), medium, text });
      sav
eLocalData();
      
      // Clear input
   
   document.getElementById('message-text').va
lue = '';
      
      renderMessages(taskLoc
al.messages);
    }
    
    function toggleA
ccordion() {
      document.getElementById('m
essages-accordion').classList.toggle('open');

    }
    
    function saveChanges() {
    
  if (!selectedTask) return;
      
      con
st taskLocal = getTaskLocalData(selectedTask.
id);
      taskLocal.notes = document.getElem
entById('notes-field').value;
      saveLocal
Data();
      
      // Update the task's loc
al notes for display
      selectedTask.local
Notes = taskLocal.notes;
      
      alert('
Changes saved locally!');
    }
    
    func
tion closeModal() {
      // Auto-save notes 
on close
      if (selectedTask) {
        co
nst taskLocal = getTaskLocalData(selectedTask
.id);
        taskLocal.notes = document.getE
lementById('notes-field').value;
        save
LocalData();
      }
      
      document.ge
tElementById('modal').classList.remove('open'
);
      selectedTask = null;
    }
    
    
function toggleStatus() {
      if (!selected
Task) return;
      
      const statuses = [
'pending', 'in-progress', 'complete'];
      
const currentIdx = statuses.indexOf(selectedT
ask.status);
      selectedTask.status = stat
uses[(currentIdx + 1) % statuses.length];
   
   
      // Save status to local storage
   
   const taskLocal = getTaskLocalData(selecte
dTask.id);
      taskLocal.status = selectedT
ask.status;
      saveLocalData();
      
   
   render();
      openTask(selectedTask.id);

    }
    
    // Filter handlers
    docume
nt.querySelectorAll('.filter-btn').forEach(bt
n => {
      btn.addEventListener('click', ()
 => {
        document.querySelectorAll('.fil
ter-btn').forEach(b => b.classList.remove('ac
tive'));
        btn.classList.add('active');

        currentFilter = btn.dataset.filter;

        renderTasks();
      });
    });
    

    // Close modal on overlay click
    docu
ment.getElementById('modal').addEventListener
('click', (e) => {
      if (e.target.id === 
'modal') closeModal();
    });
    
    docum
ent.getElementById('settings-modal').addEvent
Listener('click', (e) => {
      if (e.target
.id === 'settings-modal') closeSettings();
  
  });
    
    // Load data on start
    load
Data();
  </script>
</body>
</html>




